---
title: Installing and Running Wavefront Proxies
keywords: Ansible
tags: [proxies]
sidebar: doc_sidebar
permalink: proxies_installing.html
summary: Learn how to install and run Wavefront proxies.
---
In most cases before metrics can begin streaming to Wavefront from a host or application you must run a Wavefront proxy in your installation. 

You can install a proxy as part of an [in-product integration](integrations.html#in-product-integrations) or standalone. This topic describes various methods for installing Wavefront proxies and for managing proxy services.

Installation procedures require an Wavefront API URL `<wavefront_api_url>` in the format `https://<wavefront_instance>.wavefront.com/api/` and an API token. Some procedures configure these properties for you automatically. To get an API token, see [Generating an API Token](wavefront_api.html#generating-an-api-token).

{% include shared/permissions_view.html entity="proxies" entitymgmt="Proxy" %}

## Proxy Host Requirements

- Internet access - run `timeout 3s curl -fIsS <wavefront_api_url>` from the host and make sure you get a response rather than timing out.
- Memory - the host does not need to be dedicated to running the Wavefront proxy; the proxy does not use a large amount of CPU, memory, or storage. However, we recommend running the proxy on a host with at least 4GB of free memory.
- Operating system
  - Linux
    - Ubuntu 12.04, 14.04, 16.04
    - CentOS 6.5, 7
    - RHEL 6, 7
    - Debian 7, 8, 9, 10
    - Amazon Linux
  - Mac - MacOS Sierra (10.12)

<a name="single"></a>

## Installing a Proxy on a Single Host

To install and run a proxy on a Linux or Mac host, or in a Docker container on a host:

1. Open the Wavefront application UI.
1. Select **Browse > Proxies**.
1. Select **Add > New Proxy** at the top of the filter bar. The Add a Wavefront Proxy screen displays.
1. Click the **\[Linux \| MacOS \| Docker ]** tab.
1. Copy the script and run on your host.
1. After the proxy contacts the Wavefront server, the proxy name displays under "Checking for new proxies..." and the button label changes to Done.
1. Click **Done**. The Proxies page displays. Verify that your proxy is listed. If not, follow the steps in [Managing Proxy Services](#managing-proxy-services) to make sure the proxy is running.

<a name="ansible"></a>

## Installing Proxies on Multiple Linux Hosts

Ansible is an open-source automation engine that automates software provisioning, configuration management, and application deployment. The Wavefront Ansible role installs and configures the Wavefront proxy, which allows you to automate Wavefront proxy installation on multiple Linux hosts. For details, see the [Ansible in-product integration](integrations.html#in-product-integrations) setup instructions.

<a name="restart"></a>

## Managing Proxy Services

This section describes how to start and stop the proxy service, check service status, and view the logs generated by the service. See [Logging](proxies_configuring.html#logging) for log configuration options.

If a proxy won't start or [register with Wavefront](proxies_managing.html#viewing-registered-proxies) and you need help, contact [Support]({{site.support_link}}).

### Starting and Stopping a Proxy

Run the following commands on the proxy host:

- Linux

  ```shell
  $ service wavefront-proxy [start | stop | restart]
  ```
- Mac

  ```shell
  $ brew services [start | stop | restart] wfproxy
  ```
- Docker

  ```shell
  $ docker [start | stop ] <proxy_container_id>
  ```

### Checking Proxy Service Status
 
To check if the proxy is running, run the following commands on the proxy host:

- Linux

  ```shell
  $ service wavefront-proxy status
  ```
  You can view the proxy log at `/var/log/wavefront/wavefront.log`. 
- Mac

  ```shell
  $ brew services list
  ```
  You can view the proxy log at `/usr/local/var/log/wavefront/wavefront.log`.
- Docker

  ```
  $ docker ps
  ```
  To view the proxy log, run `docker logs <proxy_container_id>`.
  

### Testing a Proxy 

You can test that a proxy is receiving and sending data by sending it a JSON payload as follows:

1. In the [proxy configuration file](proxies_configuring.html), set the JSON listener port to 3878.

   ```
   jsonListenerPorts=3878
   ```
1. Run the command:

   ```shell
   curl --header "Content-type: application/json" \
   'http://<wavefront_proxy_address>:3878/?h=test_host&d=now' \
   -d '{"test.metric":{"value":1,"tags":{"key1":"v1","key2":"v2"}}}'
   ```
   where `<wavefront_proxy_address>` is the address of your Wavefront proxy.
1. In the Wavefront UI, select **Browse > Metrics**.
1. In the Metrics field, type `test.metric`.
1. Click `test.metric` to display a chart of the metric.

<a name="docker"></a>

## Running a Proxy in a Docker Container

To run a Docker container using the Docker run command, follow the instructions in [Installing a Proxy on a Single Host](#single). If you want to use Docker Compose or Kubernetes to run the proxy, use the configurations below, setting the `WAVEFRONT_URL` and `WAVEFRONT_TOKEN` properties.

### Docker Compose

```yaml
wavefront:  
    hostname: wavefront-proxy
    container_name: wavefront-proxy
    ports:  
      - "3878:3878"
      - "2878:2878"
      - "4242:4242"
    environment:
      WAVEFRONT_URL: <wavefront_api_url>
      WAVEFRONT_TOKEN: <wavefront_api_token>
    image: wavefronthq/proxy:latest
    restart: always
```

### Kubernetes

```yaml
apiVersion: v1
kind: ReplicationController
metadata:
  labels:
    app: wavefront-proxy
    name: wavefront-proxy
  name: wavefront-proxy
  namespace: default
spec:
  replicas: 1
  selector:
    app: wavefront-proxy
  template:
    metadata:
      labels:
        app: wavefront-proxy
    spec:  
      containers:
      - name: wavefront-proxy
        image: wavefronthq/proxy:latest
        imagePullPolicy: Always
        env:
        - name: WAVEFRONT_URL
          value: <wavefront_api_url>
        - name: WAVEFRONT_TOKEN
          value: <wavefront_api_token>
        ports:  
        - containerPort: 2878
          protocol: TCP
        - containerPort: 4242
          protocol: TCP
```

## Troubleshooting

<table>
<colgroup>
<col width="33%"/>
<col width="33%"/>
<col width="33%"/>
</colgroup>
<thead>
<tr>
<th>Error</th>
<th>Reason</th>
<th>Resolution</th>
</tr>
</thead>
<tbody>
<tr>
<td>You see "java: command not found" in <code>wavefront.log</code>.</td>
<td>Java is either not installed, or is not in your path.</td>
<td>Install Java using your local package manager, and make sure that your path includes the Java binary.</td>
</tr>
<tr>
<td>You see "Cannot fetch daemon configuration from remote server: org.jboss.resteasy.client.exception.ResteasyIOException: IOException" in <code>wavefront.log</code>.</td>
<td>You may have an incorrect server URL in your wavefront.conf file; you may have blocked the outgoing connection to that server URL (port 443); or the Wavefront servers may be down.</td>
<td>Run <code>curl &lt;wavefrontServerUrl&gt;</code> from the machine running the proxy, where <code>&lt;wavefrontServerUrl&gt;</code> is the full URL (including "https://) provided to you by Wavefront and in your <code>wavefront.conf</code> file.</td>
</tr>
<tr>
<td>You see "Cannot post work unit result to Wavefront servers. Will enqueue and retry later." in <code>wavefront.log</code>.</td>
<td>You may have an incorrect server URL in your <code>wavefront.conf</code> file; you may have blocked the outgoing connection to that server URL (port 443); or the Wavefront servers may be down.</td>
<td>Run <code>curl &lt;wavefrontServerUrl&gt;</code> from the machine running the proxy, where <code>&lt;wavefrontServerUrl&gt;</code> is the full URL (including "https://") provided to you by Wavefront and in your <code>wavefront.conf</code> file.</td>
</tr>
<tr>
<td>You see "Exception in thread "main" java.lang.UnsupportedClassVersionError:
com/sunnylabs/GraphiteValidator : Unsupported major.minor version 51.0" in <code>wavefront.log</code>.
</td>
<td>You are using Java 1.6 or lower instead of Java 1.7.</td>
<td>Upgrade Java to 1.7 through your local package manager.</td>
</tr>
<tr>
<td>You see "Exception in thread "Thread-2" java.net.BindException: Address already in use" in <code>wavefront.log</code>.</td>
<td>You already have another process listening on port 2878, or may have started two proxies accidentally.</td>
<td>Use the <code>ps</code> command to find and kill any existing proxies, and then start the proxy again.</td>
</tr>
<tr>
<td>You can't "telnet localhost 2878"; the connection is refused.</td>
<td>You may have an iptables rule blocking the traffic; the proxy might not be running; or you may be running "telnet localhost 2878" from a different machine from where the proxy is running.</td>
<td>Use the <code>ps</code> command to make sure that the proxy is running, and examine your iptables rules to ensure that TCP port 2878 is accessible locally.</td>
</tr>
</tbody>
</table>