<!DOCTYPE html>
<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Learn how to configure Wavefront proxy preprocessor rules.">
<meta name="keywords" content="proxies,  ">
<title>Configuring Wavefront Proxy Preprocessor Rules | Wavefront</title>
<link rel="stylesheet" href="css/syntax.css">


<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
<!--<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">-->
<link rel="stylesheet" href="css/modern-business.css">
<link rel="stylesheet" href="css/lavish-bootstrap.css">
<link rel="stylesheet" href="css/customstyles.css">
<link rel="stylesheet" href="css/theme-blue.css">

<!-- the google_analytics_id gets auto inserted from the config file -->



<script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-91867056-1','auto');ga('require','displayfeatures');ga('send','pageview');</script>



<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="js/jquery.navgoco.min.js"></script>


<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/2.0.0/anchor.min.js"></script>
<script src="js/toc.js"></script>
<script src="js/customscripts.js"></script>

<link rel="shortcut icon" href="images/wavefront_favicon.ico">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<link rel="alternate" type="application/rss+xml" title="" href="http://localhost:4000feed.xml">

    <script>
        $(document).ready(function() {
            // Initialize navgoco with default options
            $("#mysidebar").navgoco({
                caretHtml: '',
                accordion: true,
                openClass: 'active', // open
                save: false, // leave false or nav highlighting doesn't work right
                cookie: {
                    name: 'navgoco',
                    expires: false,
                    path: '/'
                },
                slide: {
                    duration: 400,
                    easing: 'swing'
                }
            });

            $("#collapseAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', false);
            });

            $("#expandAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', true);
            });

        });

    </script>
    <script>
        $(function () {
            $('[data-toggle="tooltip"]').tooltip()
        })
    </script>
    

</head>
<body>
<!-- Navigation -->
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container topnavlinks">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="fa fa-lg navbar-brand" href="index.html">
                <img src="images/wavefront_logo_white.png"></a>
        </div>
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <!-- entries without drop-downs appear here -->
                
                
                
                <li><a href="index.html">Documentation</a></li>
                
                
                
                <li><a href="news">News</a></li>
                
                
                
                <!-- entries with drop-downs appear here -->
                <!-- conditional logic to control which topnav appears for the audience defined in the configuration file.-->
                
                
			<li>



  <a class="email" title="Submit feedback" href="#" onclick="javascript:window.location='mailto:stephanie@wavefront.com?subject=Wavefront Documentation feedback&body=I have some feedback about the Configuring Wavefront Proxy Preprocessor Rules page: ' + window.location.href;"><i class="fa fa-envelope-o"></i> Feedback</a>

</li>

		
                <!--comment out this block if you want to hide search-->
                <li>
                    <!--start search-->
                    <div id="search-demo-container">
                        <input type="text" id="search-input" placeholder="search...">
                        <ul id="results-container"></ul>
                    </div>
                    <script src="js/jekyll-search.js" type="text/javascript"></script>
                    <script type="text/javascript">
                            SimpleJekyllSearch.init({
                                searchInput: document.getElementById('search-input'),
                                resultsContainer: document.getElementById('results-container'),
                                dataSource: 'search.json',
                                searchResultTemplate: '<li><a href="{url}" title="Configuring Wavefront Proxy Preprocessor Rules">{title}</a></li>',
                                noResultsText: 'No results found.', limit: 10, fuzzy: true, })
                    </script>
                    <!--end search-->
                </li>
            </ul>
        </div>
        </div>
        <!-- /.container -->
</nav>

<!-- Page Content -->
<div class="container">
    <div class="col-lg-12">&nbsp;</div>
    <!-- Content Row -->
    <div class="row">
        <!-- Sidebar Column -->
        <div class="col-md-3">

          


<ul id="mysidebar" class="nav">
    <li class="sidebarTitle">Wavefront </li>
    
    
    
    <li>
        <a href="#">Overview</a>
        <ul>
            
            
            
            <li><a href="index.html">About Wavefront Documentation</a></li>
            
            
            
            
            
            
            <li><a href="wavefront_introduction.html">Introduction to Wavefront</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Getting Started</a>
        <ul>
            
            
            
            <li><a href="documentation_introductory.html">Introductory Documentation</a></li>
            
            
            
            
            
            
            <li><a href="dashboards_introductory.html">Introductory Dashboards</a></li>
            
            
            
            
            
            
            <li><a href="tags_overview.html">Tags Overview</a></li>
            
            
            
            
            
            
            <li><a href="wavefront_api.html">Using the Wavefront API</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Release Notes</a>
        <ul>
            
            
            
            <li><a href="50_release_notes.html">5.0 Release Notes</a></li>
            
            
            
            
            
            
            <li><a href="wavefront_obsolescence_policy.html">Wavefront Obsolescence Policy</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Wavefront Data</a>
        <ul>
            
            
            
            <li><a href="wavefront_data_ingestion.html">Getting Data into Wavefront</a></li>
            
            
            
            
            
            
            <li><a href="wavefront_data_format.html">Wavefront Data Format</a></li>
            
            
            
            
            
            
            <li><a href="wavefront_data_naming.html">Wavefront Data Naming Best Practices</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Proxies</a>
        <ul>
            
            
            
            <li><a href="proxies_installing.html">Installing Wavefront Proxies</a></li>
            
            
            
            
            
            
            <li><a href="proxies_installing_ansible.html">Installing Wavefront Proxies with Ansible</a></li>
            
            
            
            
            
            
            <li><a href="proxies_running_docker.html">Running a Proxy in a Docker Container</a></li>
            
            
            
            
            
            
            <li><a href="proxies_managing.html">Managing Wavefront Proxies</a></li>
            
            
            
            
            
            
            <li><a href="wavefront_cli.html">Wavefront CLI</a></li>
            
            
            
            
            
            
            <li><a href="proxies_configuring.html">Configuring Wavefront Proxies</a></li>
            
            
            
            
            
            
            <li class="active"><a href="proxies_preprocessor_rules.html">Configuring Wavefront Proxy Preprocessor Rules</a></li>
            
            
            
            
            
            
            <li><a href="proxies_version_history.html">Wavefront Proxy Version History</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Query Language</a>
        <ul>
            
            
            
            <li><a href="query_language_getting_started.html">Getting Started with Wavefront Query Language</a></li>
            
            
            
            
            
            
            <li><a href="query_language_query_builder.html">Query Builder</a></li>
            
            
            
            
            
            
            <li><a href="query_language_query_wizard.html">Query Wizard</a></li>
            
            
            
            
            
            
            <li><a href="query_language_reference.html">Wavefront Query Language Reference</a></li>
            
            
            
            
            
            
            <li><a href="query_language_using_point_tags.html">Using Point Tags in Queries</a></li>
            
            
            
            
            
            
            <li><a href="query_language_series_matching.html">Series Matching</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Dashboards and Charts</a>
        <ul>
            
            
            
            <li><a href="dashboards.html">Wavefront Dashboards</a></li>
            
            
            
            
            
            
            <li><a href="charts.html">Wavefront Charts</a></li>
            
            
            
            
            
            
            <li><a href="dashboards_searching.html">Searching Dashboards</a></li>
            
            
            
            
            
            
            <li><a href="dashboards_interacting.html">Interacting with Dashboards and Charts</a></li>
            
            
            
            
            
            
            <li><a href="charts_creating.html">Creating a Chart</a></li>
            
            
            
            
            
            
            <li><a href="charts_units.html">Units in Chart Axes and Legends</a></li>
            
            
            
            
            
            
            <li><a href="dashboards_managing.html">Managing Dashboards</a></li>
            
            
            
            
            
            
            <li><a href="dashboards_variables.html">Dashboard Variables</a></li>
            
            
            
            
            
            
            <li><a href="metrics_managing.html">Managing Metrics</a></li>
            
            
            
            
            
            
            <li><a href="sources_managing.html">Managing Sources</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Alerts</a>
        <ul>
            
            
            
            <li><a href="alerts_creating.html">Creating an Alert</a></li>
            
            
            
            
            
            
            <li><a href="alerts_managing.html">Managing Alerts</a></li>
            
            
            
            
            
            
            <li><a href="alerts_states_lifecycle.html">Alert States and Lifecycle</a></li>
            
            
            
            
            
            
            <li><a href="maintenance_windows_managing.html">Managing Maintenance Windows</a></li>
            
            
            
            
            
            
            <li><a href="alerts_integrating_hipchat.html">Integrating HipChat with Alerts</a></li>
            
            
            
            
            
            
            <li><a href="alerts_integrating_pagerduty.html">Integrating PagerDuty with Alerts</a></li>
            
            
            
            
            
            
            <li><a href="alerts_integrating_slack.html">Integrating Slack with Alerts</a></li>
            
            
            
            
            
            
            <li><a href="alerts_integrating_victorops.html">Integrating VictorOps with Alerts</a></li>
            
            
            
            
            
            
            <li><a href="alerts_integrating_webhooks.html">Integrating Webhooks with Alerts</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Events</a>
        <ul>
            
            
            
            <li><a href="events_managing.html">Managing Events</a></li>
            
            
            
            
            
            
            <li><a href="charts_events_displaying.html">Displaying Events in Charts</a></li>
            
            
            
            
            
            
            <li><a href="events_queries.html">Basic events() Queries</a></li>
            
            
            
            
            
            
            <li><a href="events_queries_advanced.html">Advanced events() Queries</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Integrations</a>
        <ul>
            
            
            
            <li><a href="integrations_wavefront.html">Wavefront Integrations</a></li>
            
            
            
            <li class="subfolders">
                <a href="#">Data Integrations</a>
                <ul>
                    
                    
                    
                    <li><a href="integrations_graphite.html">Graphite Integration</a></li>
                    
                    
                    
                    
                    
                    <li><a href="integrations_jmxtrans.html">JMXTrans Integration</a></li>
                    
                    
                    
                    
                    
                    <li><a href="integrations_opentsdb.html">OpenTSDB Integration</a></li>
                    
                    
                    
                    
                    
                    <li><a href="integrations_statsd.html">StatsD Integration</a></li>
                    
                    
                    
                    
                    
                    <li><a href="integrations_telegraf.html">Telegraf Integration</a></li>
                    
                    
                    
                    
                    
                    <li><a href="integrations_puppet_server.html">Puppet Server Integration</a></li>
                    
                    
                    
                </ul>
            </li>
            
            
            
            <li class="subfolders">
                <a href="#">Container Integrations</a>
                <ul>
                    
                    
                    
                    <li><a href="integrations_cadvisor.html">Docker Integration</a></li>
                    
                    
                    
                    
                    
                    <li><a href="integrations_kubernetes.html">Kubernetes Integration</a></li>
                    
                    
                    
                </ul>
            </li>
            
            
            
            <li class="subfolders">
                <a href="#">Code Instrumentation</a>
                <ul>
                    
                    
                    
                    <li><a href="integrations_go_metrics.html">Go Metrics Integration</a></li>
                    
                    
                    
                    
                    
                    <li><a href="integrations_dropwizard_metrics.html">Dropwizard Metrics Integration</a></li>
                    
                    
                    
                </ul>
            </li>
            
            
            
            <li class="subfolders">
                <a href="#">AWS Integrations</a>
                <ul>
                    
                    
                    
                    <li><a href="integrations_aws_metrics.html">AWS Metrics Integration</a></li>
                    
                    
                    
                    
                    
                    <li><a href="integrations_aws_ecs.html">AWS ECS Integration</a></li>
                    
                    
                    
                </ul>
            </li>
            
            
            
            <li class="subfolders">
                <a href="#">Authentication Integrations</a>
                <ul>
                    
                    
                    
                    <li><a href="integrations_sso_adfs.html">ADFS SSO Integration</a></li>
                    
                    
                    
                    
                    
                    <li><a href="integrations_sso_google.html">Google SSO Integration</a></li>
                    
                    
                    
                    
                    
                    <li><a href="integrations_sso_okta.html">Okta SSO Integration</a></li>
                    
                    
                    
                    
                    
                    <li><a href="integrations_sso_onelogin.html">OneLogin SSO Integration</a></li>
                    
                    
                    
                </ul>
            </li>
            
            
            
            
            
            
            <li><a href="external_links_managing.html">Managing External Links</a></li>
            
            
            
            
            
            
            <li><a href="integrations_log_data.html">Sending Log Data Metrics To Wavefront</a></li>
            
            
            
            
            
            
            <li><a href="rendering_test.html">Title</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Administration</a>
        <ul>
            
            
            
            <li><a href="permissions.html">Permissions Overview</a></li>
            
            
            
            
            
            
            <li><a href="users_managing.html">Managing Users</a></li>
            
            
            
            
            
            
            <li><a href="users_prefs_configuring.html">Configuring User Preferences</a></li>
            
            
            
            
            
            
            <li><a href="wavefront_monitoring.html">Wavefront Monitoring</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Labels</a>
        <ul>
            
            
            
            <li><a href="label_overview.html">Label Overview</a></li>
            
            
            
            <li class="subfolders">
                <a href="#">Label Pages</a>
                <ul>
                    
                    
                    
                    <li><a href="label_getting_started.html">Getting Started Pages</a></li>
                    
                    
                    
                    
                    
                    <li><a href="label_administration.html">Administration Pages</a></li>
                    
                    
                    
                    
                    
                    <li><a href="label_alerts.html">Alert Pages</a></li>
                    
                    
                    
                    
                    
                    <li><a href="label_api.html">API Pages</a></li>
                    
                    
                    
                    
                    
                    <li><a href="label_charts.html">Chart Pages</a></li>
                    
                    
                    
                    
                    
                    <li><a href="label_dashboards.html">Dashboard Pages</a></li>
                    
                    
                    
                    
                    
                    <li><a href="label_data.html">Data Pages</a></li>
                    
                    
                    
                    
                    
                    <li><a href="label_events.html">Event Pages</a></li>
                    
                    
                    
                    
                    
                    <li><a href="label_integrations.html">Integration Pages</a></li>
                    
                    
                    
                    
                    
                    <li><a href="label_proxies.html">Proxy Pages</a></li>
                    
                    
                    
                    
                    
                    <li><a href="label_query_language.html">Query Language Pages</a></li>
                    
                    
                    
                    
                    
                    <li><a href="label_release_notes.html">Release Notes Pages</a></li>
                    
                    
                    
                </ul>
            </li>
            
            
            
            
        </ul>
        
        
        
        <!-- if you aren't using the accordion, uncomment this block:
           <p class="external">
               <a href="#" id="collapseAll">Collapse All</a> | <a href="#" id="expandAll">Expand All</a>
           </p>
           -->
    </li>
</ul>
</div>

<!-- this highlights the active parent class in the navgoco sidebar. this is critical so that the parent expands when you're viewing a page. This must appear below the sidebar code above. Otherwise, if placed inside customscripts.js, the script runs before the sidebar code runs and the class never gets inserted.-->
<script>$("li.active").parents('li').toggleClass("active");</script>

    <!-- Content Column -->
    <div class="col-md-9">
        <div class="post-header">
   <h1 class="post-title-main">Configuring Wavefront Proxy Preprocessor Rules</h1>
</div>



<div class="post-content">

   
    <div class="summary">Learn how to configure Wavefront proxy preprocessor rules.</div>
   

    
    
<!-- this handles the automatic toc. use ## for subheads to auto-generate the on-page minitoc. if you use html tags, you must supply an ID for the heading element in order for it to appear in the minitoc. -->
<script>
$( document ).ready(function() {
  // Handler for .ready() called.

$('#toc').toc({ minimumHeaders: 0, listType: 'ul', showSpeed: 0, headers: 'h2,h3,h4' });

/* this offset helps account for the space taken up by the floating toolbar. */
$('#toc').on('click', 'a', function() {
  var target = $(this.getAttribute('href'))
    , scroll_target = target.offset().top

  $(window).scrollTop(scroll_target - 10);
  return false
})
  
});
</script>

<div id="toc"></div>

    


    
<!--
    <a target="_blank" href="https://github.com/WavefrontHQ/docs/gh-pagespages//proxies_preprocessor_rules.md" class="btn btn-default githubEditButton" role="button"><i class="fa fa-github fa-lg"></i> Edit me</a>
-->
    

  <p>Starting with version 4.1, the Wavefront proxy includes a preprocessor that applies various user-defined point filtering and altering rules before data is sent to Wavefront. One of the main goals of this functionality is to allow addressing correctable data quality issues within the existing data flow, when fixing the problem at the emitting source is not feasible. An example of such rule would be “before the point line is parsed, replace invalid characters with underscores”, which allows points that would normally be rejected to flow into the system.</p>

<h2 id="rule-configuration-file">Rule Configuration File</h2>

<p>You define the proxy preprocessor rules in a separate file, usually <code class="highlighter-rouge">/etc/wavefront/wavefront-proxy/preprocessor_rules.yaml</code>, using YAML syntax. You can specify the file in your <a href="proxies_configuration#configuration-options">proxy configuration</a>. An example rule file could look like:</p>

<div class="language-yaml highlighter-rouge"><pre class="highlight"><code><span class="c1"># rules for port 2878</span>
<span class="s1">'</span><span class="s">2878'</span><span class="pi">:</span>
  <span class="c1"># replace bad characters ("&amp;", "$", "!", "@") with underscores in the entire point line string</span>
  <span class="c1">################################################################</span>
  <span class="pi">-</span> <span class="s">rule</span>    <span class="pi">:</span> <span class="s">replace-badchars</span>
    <span class="s">action</span>  <span class="pi">:</span> <span class="s">replaceRegex</span>
    <span class="s">scope</span>   <span class="pi">:</span> <span class="s">pointLine</span>
    <span class="s">search</span>  <span class="pi">:</span> <span class="s2">"</span><span class="s">[&amp;</span><span class="se">\\</span><span class="s">$!@]"</span>
    <span class="s">replace</span> <span class="pi">:</span> <span class="s2">"</span><span class="s">_"</span>

  <span class="c1">#  remove "az" point tag if its value starts with "dev"</span>
  <span class="c1">################################################################</span>
  <span class="pi">-</span> <span class="s">rule</span>    <span class="pi">:</span> <span class="s">drop-az-tag</span>
    <span class="s">action</span>  <span class="pi">:</span> <span class="s">dropTag</span>
    <span class="s">tag</span>     <span class="pi">:</span> <span class="s">az</span>
    <span class="s">match</span>   <span class="pi">:</span> <span class="s">dev.*</span>

<span class="c1"># rules for port 4242</span>
<span class="s1">'</span><span class="s">4242'</span><span class="pi">:</span>
  <span class="c1">#  remove "az" point tag if its value starts with "dev"</span>
  <span class="c1">################################################################</span>
  <span class="pi">-</span> <span class="s">rule</span>    <span class="pi">:</span> <span class="s">drop-az-tag</span>
    <span class="s">action</span>  <span class="pi">:</span> <span class="s">dropTag</span>
    <span class="s">tag</span>     <span class="pi">:</span> <span class="s">az</span>
    <span class="s">match</span>   <span class="pi">:</span> <span class="s">dev.*</span>

  <span class="s">...</span>
</code></pre>
</div>

<p>For greater flexibility, you can define rules separately for each listening port.  The example above defines 3 rules, 2 for port 2878 and 1 for port 4242.</p>

<p>Every rule must have a <code class="highlighter-rouge">rule</code> parameter that contains the rule ID and an <code class="highlighter-rouge">action</code> parameter that contains the action to perform.</p>

<p>Rule IDs can contain alphanumeric characters, dashes, and underscores and should be descriptive and unique within the same port. In the example above, the <strong>drop-az-tag</strong> rule is defined with the same identifier for both ports, 2878 and 4242.</p>

<p>The Wavefront proxy reports a counter metric for every rule that represents the number of times a rule has been successfully applied, and the rule ID becomes part of the proxy metric <strong>~agent.preprocessor.&lt;rule&gt;.count</strong>. For example, <strong>~agent.preprocessor.replace-badchars.count</strong>. For information on proxy metrics, see Monitoring the Health of a Wavefront Instance.</p>

<h2 id="regex-notes">Regex Notes</h2>

<ul>
  <li>Backslashes in regex patterns must be double-escaped. For example, to match a dot character (“.”), use “\\.”</li>
  <li>Regex patterns in the <code class="highlighter-rouge">match</code> parameter are a full match. For example, a regex to block the point line that contains “stage” substring is “.*stage.*”.</li>
  <li>Regex patterns in the <code class="highlighter-rouge">replaceRegex</code> rule <code class="highlighter-rouge">search</code> parameter are a substring match. If <code class="highlighter-rouge">search</code> is “A” and <code class="highlighter-rouge">replace</code> is “B”, all A’s are replaced with B’s.</li>
</ul>

<h2 id="enabling-the-preprocessor">Enabling the Preprocessor</h2>

<p>To enable the preprocessor, add (or uncomment) the <code class="highlighter-rouge">preprocessorConfigFile</code> property in the <a href="proxy_configuration">Wavefront proxy configuration file</a> and set to a valid path to the rules configuration file. The rules file is validated when the proxy starts and the start-up process is aborted if any of the rules are not valid. A detailed error message is provided for every rule that fails validation.</p>

<h2 id="point-filtering-rules">Point Filtering Rules</h2>

<p>Point filtering rules support a more flexible version of the Proxy’s <code class="highlighter-rouge">whitelistRegex</code> and <code class="highlighter-rouge">blacklistRegex</code> properties, and is fully backwards compatible.</p>

<h3 id="blacklistregex">blacklistRegex</h3>

<p>Defines a regex that points must match to be filtered out.</p>

<table>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead>
<tr class="header">
<th><strong>Parameter</strong></th>
<th><strong>Value</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>action</td>
<td>blacklistRegex</td>
<td></td>
</tr>
<tr>
<td>scope</td>
<td>Any of the following:
<ul>
<li>pointLine</li>
<li>metricName</li>
<li>sourceName</li>
<li>&lt;point tag&gt;</li>
</ul></td>
<td>&quot;scope&quot; parameter allows filtering points with finer granularity:
<ul>
<li>pointLine applies to the whole point line before it's parsed (can be used with Wavefront and Graphite formats only)</li>
<li>metricName applies only to the metric name after the point is parsed</li>
<li>sourceName applies only to the source name after the point is parsed</li>
<li>any other value of the &quot;scope&quot; parameter applies to the value of a point tag with this name, after the point is parsed</li>
</ul></td>
</tr>
<tr>
<td>match</td>
<td>&lt;regex pattern&gt;</td>
<td>A pattern that input lines must match to be filtered out.</td>
</tr>
</tbody>
</table>

<p>Examples:</p>

<div class="language-yaml highlighter-rouge"><pre class="highlight"><code>  <span class="c1"># block all points with sourceName that starts with qa-statsd</span>
  <span class="c1">###############################################################</span>
  <span class="pi">-</span> <span class="s">rule</span>    <span class="pi">:</span> <span class="s">example-block-qa-statsd</span>
    <span class="s">action</span>  <span class="pi">:</span> <span class="s">blacklistRegex</span>
    <span class="s">scope</span>   <span class="pi">:</span> <span class="s">sourceName</span>
    <span class="s">match</span>   <span class="pi">:</span> <span class="s2">"</span><span class="s">qa-statsd.*"</span>

  <span class="c1"># block all points where "datacenter" point tag value starts with "west"</span>
  <span class="c1">###############################################################</span>
  <span class="pi">-</span> <span class="s">rule</span>    <span class="pi">:</span> <span class="s">example-block-west</span>
    <span class="s">action</span>  <span class="pi">:</span> <span class="s">blacklistRegex</span>
    <span class="s">scope</span>   <span class="pi">:</span> <span class="s">datacenter</span>
    <span class="s">match</span>   <span class="pi">:</span> <span class="s2">"</span><span class="s">west.*"</span>
</code></pre>
</div>

<h3 id="whitelistregex">whitelistRegex</h3>

<p>Defines a regex that points must match to be accepted. Multiple <code class="highlighter-rouge">whitelistRegex</code> rules are allowed, however a point must satisfy all of the rules; if the point doesn’t match at least one of the patterns, it is blocked.</p>

<table>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead>
<tr class="header">
<th><strong>Parameter</strong></th>
<th><strong>Value</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>action</td>
<td>whitelistRegex</td>
<td></td>
</tr>
<tr>
<td>scope</td>
<td>Any of the following:
<ul>
<li>pointLine</li>
<li>metricName</li>
<li>sourceName</li>
<li>&lt;point tag&gt;</li>
</ul></td>
<td>Allows filtering points with finer granularity:
<ul>
<li>pointLine applies to the whole point line before it's parsed (can be used with Wavefront and Graphite formats only)</li>
<li>metricName applies only to the metric name after the point is parsed</li>
<li>sourceName applies only to the source name after the point is parsed</li>
<li>any other value of the &quot;scope&quot; parameter applies to the value of a point tag with this name, after the point is parsed</li>
</ul></td>
</tr>
<tr>
<td>match</td>
<td>&lt;regex pattern&gt;</td>
<td>A pattern that input lines must match to be accepted.</td>
</tr>
</tbody>
</table>

<p>Examples:</p>

<div class="language-yaml highlighter-rouge"><pre class="highlight"><code>  <span class="c1"># only allow points that contain "prod" substring anywhere in the point line</span>
  <span class="c1">###############################################################</span>
  <span class="pi">-</span> <span class="s">rule</span>    <span class="pi">:</span> <span class="s">example-allow-only-prod</span>
    <span class="s">action</span>  <span class="pi">:</span> <span class="s">whitelistRegex</span>
    <span class="s">scope</span>   <span class="pi">:</span> <span class="s">pointLine</span>
    <span class="s">match</span>   <span class="pi">:</span> <span class="s2">"</span><span class="s">.*prod.*"</span>

  <span class="c1"># only allow points that have a "datacenter" point tag and its value starts with "west"</span>
  <span class="c1">###############################################################</span>
  <span class="pi">-</span> <span class="s">rule</span>    <span class="pi">:</span> <span class="s">example-allow-only-west</span>
    <span class="s">action</span>  <span class="pi">:</span> <span class="s">whitelistRegex</span>
    <span class="s">scope</span>   <span class="pi">:</span> <span class="s">datacenter</span>
    <span class="s">match</span>   <span class="pi">:</span> <span class="s2">"</span><span class="s">west.*"</span>
</code></pre>
</div>

<h2 id="point-altering-rules">Point Altering Rules</h2>

<p>Point altering rules allow you to replace text in the point line and add, remove, and update point tags.</p>

<h3 id="replaceregex">replaceRegex</h3>

<p>Replaces arbitrary text in the point line or any of its components:</p>

<table>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead>
<tr class="header">
<th><strong>Parameter</strong></th>
<th><strong>Value</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>action</td>
<td>replaceRegex</td>
<td></td>
</tr>
<tr>
<td>scope</td>
<td>Any of the following:
<ul>
<li>pointLine</li>
<li>metricName</li>
<li>sourceName</li>
<li>&lt;point tag&gt;</li>
</ul></td>
<td>Allows finer control over where the replacement is applied:
<ul>
<li>pointLine applies to the whole point line before it's parsed (can be used with Wavefront and Graphite formats only)</li>
<li>metricName applies only to the metric name after the point is parsed</li>
<li>sourceName applies only to the source name after the point is parsed</li>
<li>any other value of the &quot;scope&quot; parameter applies to the value of a point tag with this name, after the point is parsed</li>
</ul>
Any substitutions that address data quality issues that would normally make the data point unparseable, must be applied to the &quot;pointLine&quot; scope.</td>
</tr>
<tr>
<td>search</td>
<td>&lt;regex pattern&gt;</td>
<td>Search pattern. All substrings matching this pattern are replaced with the replacement string.</td>
</tr>
<tr>
<td>replace</td>
<td>&lt;replacement string&gt;</td>
<td>Replacement string. The empty string is allowed. To refer to a capturing group by its number, use &quot;\\1&quot;.</td>
</tr>
<tr>
<td>match (optional)</td>
<td>&lt;regex pattern&gt;</td>
<td>If specified, extract the tag only if &quot;scope&quot; (point line, source name, metric name or point tag value) matches this regular expression.</td>
</tr>
</tbody>
</table>

<p>Examples:</p>

<div class="language-yaml highlighter-rouge"><pre class="highlight"><code><span class="c1"># for "exampleCluster" point tag replace all "-" characters with dots</span>
<span class="c1">###############################################################</span>
<span class="pi">-</span> <span class="s">rule</span>    <span class="pi">:</span> <span class="s">example-cluster-name</span>
  <span class="s">action</span>  <span class="pi">:</span> <span class="s">replaceRegex</span>
  <span class="s">scope</span>   <span class="pi">:</span> <span class="s">exampleCluster</span>
  <span class="s">search</span>  <span class="pi">:</span> <span class="s2">"</span><span class="s">-"</span>
  <span class="s">replace</span> <span class="pi">:</span> <span class="s2">"</span><span class="s">."</span>

<span class="c1"># replace bad characters ("&amp;", "$", "!") with underscores in the entire point line string</span>
<span class="c1">################################################################</span>
<span class="pi">-</span> <span class="s">rule</span>    <span class="pi">:</span> <span class="s">example-replace-badchars</span>
  <span class="s">action</span>  <span class="pi">:</span> <span class="s">replaceRegex</span>
  <span class="s">scope</span>   <span class="pi">:</span> <span class="s">pointLine</span>
  <span class="s">search</span>  <span class="pi">:</span> <span class="s2">"</span><span class="s">[&amp;</span><span class="se">\\</span><span class="s">$!]"</span>
  <span class="s">replace</span> <span class="pi">:</span> <span class="s2">"</span><span class="s">_"</span>
</code></pre>
</div>

<h3 id="addtag">addTag</h3>

<p>Add a point tag with the specified value to all points. If the point tag already exists, its existing value is replaced with the new value.</p>

<table width="100%">
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead>
<tr class="header">
<th><strong>Parameter</strong></th>
<th><strong>Value</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>action</td>
<td>addTag</td>
<td></td>
</tr>
<tr>
<td>tag</td>
<td>&lt;new tag key&gt;</td>
<td>New point tag name.</td>
</tr>
<tr>
<td>value</td>
<td>&lt;new value&gt;</td>
<td>New point tag value.</td>
</tr>
</tbody>
</table>

<p>Example:</p>

<div class="language-yaml highlighter-rouge"><pre class="highlight"><code>  <span class="c1"># add "env=prod" point tag to all metrics sent through this port</span>
  <span class="c1">################################################################</span>
  <span class="pi">-</span> <span class="s">rule</span>    <span class="pi">:</span> <span class="s">tag-all-metrics</span>
    <span class="s">action</span>  <span class="pi">:</span> <span class="s">addTag</span>
    <span class="s">tag</span>     <span class="pi">:</span> <span class="s">env</span>
    <span class="s">value</span>   <span class="pi">:</span> <span class="s2">"</span><span class="s">prod"</span>
</code></pre>
</div>

<h3 id="addtagifnotexists">addTagIfNotExists</h3>

<p>Add a point tag with the specified value to all points. If the point tag already exists, its existing value is preserved.</p>

<table width="100%">
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead>
<tr class="header">
<th><strong>Parameter</strong></th>
<th><strong>Value</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>action</td>
<td>addTagIfNotExists</td>
<td></td>
</tr>
<tr>
<td>tag</td>
<td>&lt;new tag key&gt;</td>
<td>New point tag name.</td>
</tr>
<tr>
<td>value</td>
<td>&lt;new value&gt;</td>
<td>New point tag value.</td>
</tr>
</tbody>
</table>

<p>Example:</p>

<div class="language-yaml highlighter-rouge"><pre class="highlight"><code>  <span class="c1"># add "env=prod" point tag to all metrics sent through this port unless already tagged with "env"</span>
  <span class="c1">################################################################</span>
  <span class="pi">-</span> <span class="s">rule</span>    <span class="pi">:</span> <span class="s">tag-all-metrics</span>
    <span class="s">action</span>  <span class="pi">:</span> <span class="s">addTagIfNotExists</span>
    <span class="s">tag</span>     <span class="pi">:</span> <span class="s">env</span>
    <span class="s">value</span>   <span class="pi">:</span> <span class="s2">"</span><span class="s">prod"</span>
</code></pre>
</div>

<h3 id="droptag">dropTag</h3>
<p>-</p>

<p>Remove a point tag.</p>

<table>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead>
<tr class="header">
<th><strong>Parameter</strong></th>
<th><strong>Value</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>action</td>
<td>dropTag</td>
<td></td>
</tr>
<tr>
<td>tag</td>
<td>&lt;tag name&gt; or &lt;tag name regex&gt;</td>
<td>Point tag key (or a regex matching the tag key).</td>
</tr>
<tr>
<td>match (optional)</td>
<td>&lt;regex pattern&gt;</td>
<td>If specified, remove a tag if its value matches this regular expression.</td>
</tr>
</tbody>
</table>

<p>Examples:</p>

<div class="language-yaml highlighter-rouge"><pre class="highlight"><code>  <span class="c1">#  remove "dc" point tag from all points</span>
  <span class="c1">################################################################</span>
  <span class="pi">-</span> <span class="s">rule</span>    <span class="pi">:</span> <span class="s">drop-dc-tag</span>
    <span class="s">action</span>  <span class="pi">:</span> <span class="s">dropTag</span>
    <span class="s">tag</span>     <span class="pi">:</span> <span class="s">dc</span>

  <span class="c1">#  remove "az" point tag if its value starts with "dev"</span>
  <span class="c1">################################################################</span>
  <span class="pi">-</span> <span class="s">rule</span>    <span class="pi">:</span> <span class="s">drop-az-tag</span>
    <span class="s">action</span>  <span class="pi">:</span> <span class="s">dropTag</span>
    <span class="s">tag</span>     <span class="pi">:</span> <span class="s">az</span>
    <span class="s">match</span>   <span class="pi">:</span> <span class="s">dev.*</span>
</code></pre>
</div>

<h3 id="extracttag">extractTag</h3>
<p>-</p>

<p>Create a new point tag based on a metric name, source name, or another point tag value.</p>

<table>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead>
<tr class="header">
<th><strong>Parameter</strong></th>
<th><strong>Value<br />
</strong></th>
<th><strong>Description<br />
</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>action</td>
<td>extractTag</td>
<td></td>
</tr>
<tr>
<td>source</td>
<td>Any of the following:
<ul>
<li>metricName</li>
<li>sourceName</li>
<li>&lt;point tag&gt;</li>
</ul></td>
<td>The base for the new point tag value: metric name, source name, or another point tag value.</td>
</tr>
<tr>
<td>tag</td>
<td>&lt;new tag name&gt;</td>
<td>New name for the point tag.</td>
</tr>
<tr>
<td>search</td>
<td>&lt;regex pattern&gt;</td>
<td>Regex pattern to extract the value.</td>
</tr>
<tr>
<td>replace</td>
<td>&lt;replacement string&gt;</td>
<td>String or pattern (empty string is allowed) that will be used as a value for the new point tag. To refer to a capturing group in &quot;search&quot; regex by its number, use either of the following constructs: &quot;\\1&quot; or &quot;$1&quot;.</td>
</tr>
<tr>
<td>match (optional)</td>
<td>&lt;regex pattern&gt;</td>
<td>If specified, extract a tag only if &quot;source&quot; (source name, metric name or point tag value) matches this regular expression.</td>
</tr>
</tbody>
</table>

<p>Example:</p>

<div class="language-yaml highlighter-rouge"><pre class="highlight"><code>  <span class="c1"># extract a "datacenter" point tag from the source name based on '.dc-' substring.</span>
  <span class="c1"># it will extract datacenter=west01 tag from source host0001.web.dc-west01.corp</span>
  <span class="c1">####################################################################################</span>
  <span class="pi">-</span> <span class="s">rule</span>    <span class="pi">:</span> <span class="s">extract-datacenter</span>
    <span class="s">action</span>  <span class="pi">:</span> <span class="s">extractTag</span>
    <span class="s">source</span>  <span class="pi">:</span> <span class="s">sourceName</span>
    <span class="s">tag</span>     <span class="pi">:</span> <span class="s">datacenter</span>
    <span class="s">search</span>  <span class="pi">:</span> <span class="s2">"</span><span class="s">^.*</span><span class="se">\\</span><span class="s">.dc-(.*)</span><span class="se">\\</span><span class="s">..*"</span>
    <span class="s">replace</span> <span class="pi">:</span> <span class="s2">"</span><span class="s">$1"</span>
</code></pre>
</div>

<h3 id="renametag">renameTag</h3>

<p>Rename a point tag, preserving its value.</p>

<table>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead>
<tr class="header">
<th>Parameter&lt;/strong&gt;</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>action</td>
<td>renameTag</td>
<td></td>
</tr>
<tr>
<td>tag</td>
<td>&lt;tag name&gt;</td>
<td>Point tag to be renamed.</td>
</tr>
<tr>
<td>newtag</td>
<td>&lt;new tag name&gt;</td>
<td>New name for the point tag.</td>
</tr>
<tr>
<td>match (optional)</td>
<td>&lt;regex pattern&gt;</td>
<td>If specified, rename a tag if its value matches this regular expression.</td>
</tr>
</tbody>
</table>

<p>Examples:</p>

<div class="language-yaml highlighter-rouge"><pre class="highlight"><code>  <span class="c1"># rename a "dc" point tag to "datacenter" (unconditional)</span>
  <span class="c1">###############################################################</span>
  <span class="pi">-</span> <span class="s">rule</span>    <span class="pi">:</span> <span class="s">rename-dc-to-datacenter</span>
    <span class="s">action</span>  <span class="pi">:</span> <span class="s">renameTag</span>
    <span class="s">tag</span>     <span class="pi">:</span> <span class="s">dc</span>
    <span class="s">newtag</span>  <span class="pi">:</span> <span class="s">datacenter</span>

  <span class="c1"># rename a point tag if its value is numeric. so oldTag=123 would be renamed to numericTag=123, but oldTag=text123 would not be changed.</span>
  <span class="c1">###############################################################</span>
  <span class="pi">-</span> <span class="s">rule</span>    <span class="pi">:</span> <span class="s">rename-numeric-tag</span>
    <span class="s">action</span>  <span class="pi">:</span> <span class="s">renameTag</span>
    <span class="s">tag</span>     <span class="pi">:</span> <span class="s">oldTag</span>
    <span class="s">match</span>   <span class="pi">:</span> <span class="s2">"</span><span class="s">^</span><span class="se">\\</span><span class="s">d*$"</span>
    <span class="s">newtag</span>  <span class="pi">:</span> <span class="s">numericTag</span>
</code></pre>
</div>



    <div class="tags">
        
        <b>Labels: </b>
        
        
        
        <a href="label_proxies.html" class="btn btn-default navbar-btn cursorNorm label-btn" role="button">proxies</a>
        
        
        
    </div>

    

</div>

<hr class="shaded"/>

<footer>
            <div class="row">
                <div class="col-lg-12 footer">
               &copy;2017 Wavefront. All rights reserved. <br />
 Site last generated: 2017-04-03 18:42:41 -0700 <br />
<p></p>
<p><img src="images/wavefront_logo.png" alt="Wavefront logo"/></p>
                </div>
            </div>
</footer>


    </div>
    <!-- /.row -->
</div>
<!-- /.container -->
    </div>

</body>

<!-- the google_analytics_id gets auto inserted from the config file -->



<script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-91867056-1','auto');ga('require','displayfeatures');ga('send','pageview');</script>



</html>