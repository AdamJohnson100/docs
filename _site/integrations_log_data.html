<!DOCTYPE html>
<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Learn how to send log data to Wavefront.">
<meta name="keywords" content="integrations,  ">
<title>Sending Log Data to Wavefront | Wavefront</title>
<link rel="stylesheet" href="css/syntax.css">


<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
<!--<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">-->
<link rel="stylesheet" href="css/modern-business.css">
<link rel="stylesheet" href="css/lavish-bootstrap.css">
<link rel="stylesheet" href="css/customstyles.css">
<link rel="stylesheet" href="css/theme-blue.css">

<!-- the google_analytics_id gets auto inserted from the config file -->



<script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-91867056-1','auto');ga('require','displayfeatures');ga('send','pageview');</script>



<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="js/jquery.navgoco.min.js"></script>


<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/2.0.0/anchor.min.js"></script>
<script src="js/toc.js"></script>
<script src="js/customscripts.js"></script>

<link rel="shortcut icon" href="images/wavefront_favicon.ico">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<link rel="alternate" type="application/rss+xml" title="" href="http://localhost:4000feed.xml">

    <script>
        $(document).ready(function() {
            // Initialize navgoco with default options
            $("#mysidebar").navgoco({
                caretHtml: '',
                accordion: true,
                openClass: 'active', // open
                save: false, // leave false or nav highlighting doesn't work right
                cookie: {
                    name: 'navgoco',
                    expires: false,
                    path: '/'
                },
                slide: {
                    duration: 400,
                    easing: 'swing'
                }
            });

            $("#collapseAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', false);
            });

            $("#expandAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', true);
            });

        });

    </script>
    <script>
        $(function () {
            $('[data-toggle="tooltip"]').tooltip()
        })
    </script>
    

</head>
<body>
<!-- Navigation -->
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container topnavlinks">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="fa fa-lg navbar-brand" href="index.html">
                <img src="images/wavefront_logo_white.png"></a>
        </div>
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <!-- entries without drop-downs appear here -->
                
                
                
                <li><a href="index.html">Documentation</a></li>
                
                
                
                <li><a href="news">News</a></li>
                
                
                
                <!-- entries with drop-downs appear here -->
                <!-- conditional logic to control which topnav appears for the audience defined in the configuration file.-->
                
                
			<li>



  <a class="email" title="Submit feedback" href="#" onclick="javascript:window.location='mailto:stephanie@wavefront.com?subject=Wavefront Documentation feedback&body=I have some feedback about the Sending Log Data to Wavefront page: ' + window.location.href;"><i class="fa fa-envelope-o"></i> Feedback</a>

</li>

		
                <!--comment out this block if you want to hide search-->
                <li>
                    <!--start search-->
                    <div id="search-demo-container">
                        <input type="text" id="search-input" placeholder="search...">
                        <ul id="results-container"></ul>
                    </div>
                    <script src="js/jekyll-search.js" type="text/javascript"></script>
                    <script type="text/javascript">
                            SimpleJekyllSearch.init({
                                searchInput: document.getElementById('search-input'),
                                resultsContainer: document.getElementById('results-container'),
                                dataSource: 'search.json',
                                searchResultTemplate: '<li><a href="{url}" title="Sending Log Data to Wavefront">{title}</a></li>',
                                noResultsText: 'No results found.', limit: 10, fuzzy: true, })
                    </script>
                    <!--end search-->
                </li>
            </ul>
        </div>
        </div>
        <!-- /.container -->
</nav>

<!-- Page Content -->
<div class="container">
    <div class="col-lg-12">&nbsp;</div>
    <!-- Content Row -->
    <div class="row">
        <!-- Sidebar Column -->
        <div class="col-md-3">

          


<ul id="mysidebar" class="nav">
    <li class="sidebarTitle">Wavefront </li>
    
    
    
    <li>
        <a href="#">Overview</a>
        <ul>
            
            
            
            <li><a href="index.html">About Wavefront Documentation</a></li>
            
            
            
            
            
            
            <li><a href="wavefront_introduction.html">Introduction to Wavefront</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Getting Started</a>
        <ul>
            
            
            
            <li><a href="documentation_introductory.html">Introductory Documentation</a></li>
            
            
            
            
            
            
            <li><a href="dashboards_introductory.html">Introductory Dashboards</a></li>
            
            
            
            
            
            
            <li><a href="tags_overview.html">Tags Overview</a></li>
            
            
            
            
            
            
            <li><a href="wavefront_api.html">Using the Wavefront API</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Release Notes</a>
        <ul>
            
            
            
            <li><a href="50_release_notes.html">5.0 Release Notes</a></li>
            
            
            
            
            
            
            <li><a href="wavefront_obsolescence_policy.html">Wavefront Obsolescence Policy</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Wavefront Data</a>
        <ul>
            
            
            
            <li><a href="wavefront_data_ingestion.html">Getting Data into Wavefront</a></li>
            
            
            
            
            
            
            <li><a href="wavefront_data_format.html">Wavefront Data Format</a></li>
            
            
            
            
            
            
            <li><a href="wavefront_data_naming.html">Wavefront Data Naming Best Practices</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Proxies</a>
        <ul>
            
            
            
            <li><a href="proxies_installing.html">Installing Wavefront Proxies</a></li>
            
            
            
            
            
            
            <li><a href="proxies_installing_ansible.html">Installing Wavefront Proxies with Ansible</a></li>
            
            
            
            
            
            
            <li><a href="proxies_running_docker.html">Running a Proxy in a Docker Container</a></li>
            
            
            
            
            
            
            <li><a href="proxies_managing.html">Managing Wavefront Proxies</a></li>
            
            
            
            
            
            
            <li><a href="wavefront_cli.html">Wavefront CLI</a></li>
            
            
            
            
            
            
            <li><a href="proxies_configuring.html">Configuring Wavefront Proxies</a></li>
            
            
            
            
            
            
            <li><a href="proxies_preprocessor_rules.html">Configuring Wavefront Proxy Preprocessor Rules</a></li>
            
            
            
            
            
            
            <li><a href="proxies_version_history.html">Wavefront Proxy Version History</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Query Language</a>
        <ul>
            
            
            
            <li><a href="query_language_getting_started.html">Getting Started with Wavefront Query Language</a></li>
            
            
            
            
            
            
            <li><a href="query_language_query_builder.html">Query Builder</a></li>
            
            
            
            
            
            
            <li><a href="query_language_query_wizard.html">Query Wizard</a></li>
            
            
            
            
            
            
            <li><a href="query_language_reference.html">Wavefront Query Language Reference</a></li>
            
            
            
            
            
            
            <li><a href="query_language_using_point_tags.html">Using Point Tags in Queries</a></li>
            
            
            
            
            
            
            <li><a href="query_language_series_matching.html">Series Matching</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Dashboards and Charts</a>
        <ul>
            
            
            
            <li><a href="dashboards.html">Wavefront Dashboards</a></li>
            
            
            
            
            
            
            <li><a href="charts.html">Wavefront Charts</a></li>
            
            
            
            
            
            
            <li><a href="dashboards_searching.html">Searching Dashboards</a></li>
            
            
            
            
            
            
            <li><a href="dashboards_interacting.html">Interacting with Dashboards and Charts</a></li>
            
            
            
            
            
            
            <li><a href="charts_creating.html">Creating a Chart</a></li>
            
            
            
            
            
            
            <li><a href="charts_units.html">Units in Chart Axes and Legends</a></li>
            
            
            
            
            
            
            <li><a href="dashboards_managing.html">Managing Dashboards</a></li>
            
            
            
            
            
            
            <li><a href="dashboards_variables.html">Dashboard Variables</a></li>
            
            
            
            
            
            
            <li><a href="metrics_managing.html">Managing Metrics</a></li>
            
            
            
            
            
            
            <li><a href="sources_managing.html">Managing Sources</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Alerts</a>
        <ul>
            
            
            
            <li><a href="alerts_creating.html">Creating an Alert</a></li>
            
            
            
            
            
            
            <li><a href="alerts_managing.html">Managing Alerts</a></li>
            
            
            
            
            
            
            <li><a href="alerts_states_lifecycle.html">Alert States and Lifecycle</a></li>
            
            
            
            
            
            
            <li><a href="maintenance_windows_managing.html">Managing Maintenance Windows</a></li>
            
            
            
            
            
            
            <li><a href="alerts_integrating_hipchat.html">Integrating HipChat with Alerts</a></li>
            
            
            
            
            
            
            <li><a href="alerts_integrating_pagerduty.html">Integrating PagerDuty with Alerts</a></li>
            
            
            
            
            
            
            <li><a href="alerts_integrating_slack.html">Integrating Slack with Alerts</a></li>
            
            
            
            
            
            
            <li><a href="alerts_integrating_victorops.html">Integrating VictorOps with Alerts</a></li>
            
            
            
            
            
            
            <li><a href="alerts_integrating_webhooks.html">Integrating Webhooks with Alerts</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Events</a>
        <ul>
            
            
            
            <li><a href="events_managing.html">Managing Events</a></li>
            
            
            
            
            
            
            <li><a href="charts_events_displaying.html">Displaying Events in Charts</a></li>
            
            
            
            
            
            
            <li><a href="events_queries.html">Basic events() Queries</a></li>
            
            
            
            
            
            
            <li><a href="events_queries_advanced.html">Advanced events() Queries</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Integrations</a>
        <ul>
            
            
            
            <li><a href="integrations_wavefront.html">Wavefront Integrations</a></li>
            
            
            
            <li class="subfolders">
                <a href="#">Data Integrations</a>
                <ul>
                    
                    
                    
                    <li><a href="integrations_graphite.html">Graphite Integration</a></li>
                    
                    
                    
                    
                    
                    <li><a href="integrations_jmxtrans.html">JMXTrans Integration</a></li>
                    
                    
                    
                    
                    
                    <li><a href="integrations_opentsdb.html">OpenTSDB Integration</a></li>
                    
                    
                    
                    
                    
                    <li><a href="integrations_statsd.html">StatsD Integration</a></li>
                    
                    
                    
                    
                    
                    <li><a href="integrations_telegraf.html">Telegraf Integration</a></li>
                    
                    
                    
                    
                    
                    <li><a href="integrations_puppet_server.html">Puppet Server Integration</a></li>
                    
                    
                    
                </ul>
            </li>
            
            
            
            <li class="subfolders">
                <a href="#">Container Integrations</a>
                <ul>
                    
                    
                    
                    <li><a href="integrations_cadvisor.html">Docker Integration</a></li>
                    
                    
                    
                    
                    
                    <li><a href="integrations_kubernetes.html">Kubernetes Integration</a></li>
                    
                    
                    
                </ul>
            </li>
            
            
            
            <li class="subfolders">
                <a href="#">Code Instrumentation</a>
                <ul>
                    
                    
                    
                    <li><a href="integrations_go_metrics.html">Go Metrics Integration</a></li>
                    
                    
                    
                    
                    
                    <li><a href="integrations_dropwizard_metrics.html">Dropwizard Metrics Integration</a></li>
                    
                    
                    
                </ul>
            </li>
            
            
            
            <li class="subfolders">
                <a href="#">AWS Integrations</a>
                <ul>
                    
                    
                    
                    <li><a href="integrations_aws_metrics.html">AWS Metrics Integration</a></li>
                    
                    
                    
                    
                    
                    <li><a href="integrations_aws_ecs.html">AWS ECS Integration</a></li>
                    
                    
                    
                </ul>
            </li>
            
            
            
            <li class="subfolders">
                <a href="#">Authentication Integrations</a>
                <ul>
                    
                    
                    
                    <li><a href="integrations_sso_adfs.html">ADFS SSO Integration</a></li>
                    
                    
                    
                    
                    
                    <li><a href="integrations_sso_google.html">Google SSO Integration</a></li>
                    
                    
                    
                    
                    
                    <li><a href="integrations_sso_okta.html">Okta SSO Integration</a></li>
                    
                    
                    
                    
                    
                    <li><a href="integrations_sso_onelogin.html">OneLogin SSO Integration</a></li>
                    
                    
                    
                </ul>
            </li>
            
            
            
            
            
            
            <li><a href="external_links_managing.html">Managing External Links</a></li>
            
            
            
            
            
            
            <li class="active"><a href="integrations_log_data.html">Sending Log Data Metrics To Wavefront</a></li>
            
            
            
            
            
            
            <li><a href="rendering_test.html">Title</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Administration</a>
        <ul>
            
            
            
            <li><a href="permissions.html">Permissions Overview</a></li>
            
            
            
            
            
            
            <li><a href="users_managing.html">Managing Users</a></li>
            
            
            
            
            
            
            <li><a href="users_prefs_configuring.html">Configuring User Preferences</a></li>
            
            
            
            
            
            
            <li><a href="wavefront_monitoring.html">Wavefront Monitoring</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Labels</a>
        <ul>
            
            
            
            <li><a href="label_overview.html">Label Overview</a></li>
            
            
            
            <li class="subfolders">
                <a href="#">Label Pages</a>
                <ul>
                    
                    
                    
                    <li><a href="label_getting_started.html">Getting Started Pages</a></li>
                    
                    
                    
                    
                    
                    <li><a href="label_administration.html">Administration Pages</a></li>
                    
                    
                    
                    
                    
                    <li><a href="label_alerts.html">Alert Pages</a></li>
                    
                    
                    
                    
                    
                    <li><a href="label_api.html">API Pages</a></li>
                    
                    
                    
                    
                    
                    <li><a href="label_charts.html">Chart Pages</a></li>
                    
                    
                    
                    
                    
                    <li><a href="label_dashboards.html">Dashboard Pages</a></li>
                    
                    
                    
                    
                    
                    <li><a href="label_data.html">Data Pages</a></li>
                    
                    
                    
                    
                    
                    <li><a href="label_events.html">Event Pages</a></li>
                    
                    
                    
                    
                    
                    <li><a href="label_integrations.html">Integration Pages</a></li>
                    
                    
                    
                    
                    
                    <li><a href="label_proxies.html">Proxy Pages</a></li>
                    
                    
                    
                    
                    
                    <li><a href="label_query_language.html">Query Language Pages</a></li>
                    
                    
                    
                    
                    
                    <li><a href="label_release_notes.html">Release Notes Pages</a></li>
                    
                    
                    
                </ul>
            </li>
            
            
            
            
        </ul>
        
        
        
        <!-- if you aren't using the accordion, uncomment this block:
           <p class="external">
               <a href="#" id="collapseAll">Collapse All</a> | <a href="#" id="expandAll">Expand All</a>
           </p>
           -->
    </li>
</ul>
</div>

<!-- this highlights the active parent class in the navgoco sidebar. this is critical so that the parent expands when you're viewing a page. This must appear below the sidebar code above. Otherwise, if placed inside customscripts.js, the script runs before the sidebar code runs and the class never gets inserted.-->
<script>$("li.active").parents('li').toggleClass("active");</script>

    <!-- Content Column -->
    <div class="col-md-9">
        <div class="post-header">
   <h1 class="post-title-main">Sending Log Data to Wavefront</h1>
</div>



<div class="post-content">

   
    <div class="summary">Learn how to send log data to Wavefront.</div>
   

    
    
<!-- this handles the automatic toc. use ## for subheads to auto-generate the on-page minitoc. if you use html tags, you must supply an ID for the heading element in order for it to appear in the minitoc. -->
<script>
$( document ).ready(function() {
  // Handler for .ready() called.

$('#toc').toc({ minimumHeaders: 0, listType: 'ul', showSpeed: 0, headers: 'h2,h3,h4' });

/* this offset helps account for the space taken up by the floating toolbar. */
$('#toc').on('click', 'a', function() {
  var target = $(this.getAttribute('href'))
    , scroll_target = target.offset().top

  $(window).scrollTop(scroll_target - 10);
  return false
})
  
});
</script>

<div id="toc"></div>

    


    
<!--
    <a target="_blank" href="https://github.com/WavefrontHQ/docs/gh-pagespages//integrations_log_data.md" class="btn btn-default githubEditButton" role="button"><i class="fa fa-github fa-lg"></i> Edit me</a>
-->
    

  <p>Usually the best way to send metrics to a monitoring system is to us a metrics library. However, sometimes you have a legacy system, or a system that is difficult to modify, and you want to garner metrics from log data. This article describes two methods for sending log data metrics directly to your Wavefront proxy: Filebeat and TCP. These methods are supported in Wavefront proxy 4.4 and higher.</p>

<p>Both methods set up metrics harvesting with aggregation, in that time series are held in memory and periodically flushed to Wavefront. This allows you to control your points-per-second, and it also allows you to aggregate the same metric across multiple nodes. However, this has the limitation that each individual metric must always arrive at the <em>same</em> Wavefront proxy. If you only use one Proxy you don’t have to worry about this, but if you have a multi-Proxy deployment, the easiest way is to send all of your logs to the same Proxy. That way each metric only has one possible pool for aggregation.</p>

<h2 id="configuring-the-wavefront-proxy-to-ingest-log-data">Configuring the Wavefront Proxy to Ingest Log Data</h2>

<p>In this example, we configure Wavefront to parse <a href="http://httpd.apache.org/docs/1.3/logs.html#combined">Combined Apache Logs</a>, which is a common logging format for many web services (for example, NGINX). The example is merely a starting point – by the end you will see how to ingest metrics from any log format.</p>

<h3 id="configuring-the-wavefront-proxy-to-listen-for-log-data">Configuring the Wavefront Proxy to Listen for Log Data</h3>

<p>In your Wavefront proxy <a href="proxy_configuration">configuration file</a>, add these new entries:</p>

<div class="language-conf highlighter-rouge"><pre class="highlight"><code><span class="n">filebeatPort</span>=<span class="m">5044</span>
<span class="n">rawLogsPort</span>=<span class="m">5055</span>
<span class="n">logsIngestionConfigFile</span>=/<span class="n">etc</span>/<span class="n">wavefront</span>/<span class="n">wavefront</span>-<span class="n">proxy</span>/<span class="n">logsIngestion</span>.<span class="n">yaml</span>
</code></pre>
</div>

<p>These entries instruct the Wavefront proxy to listen for log data in various formats: on port 5044 it listens using the <a href="http://github.com/elastic/logstash-forwarder/blob/master/PROTOCOL.md">Lumberjack protocol</a>, which works with <a href="http://www.elastic.co/products/beats/filebeat">Filebeat</a>, and on port 5055 it listens for raw logs data over a TCP socket as a UTF-8 encoded string (which works with Splunk, and many others).</p>

<h3 id="configuring-the-wavefront-proxy-to-add-structure-to-log-data">Configuring the Wavefront Proxy to Add Structure to Log Data</h3>

<p>You use grok patterns (similar to <a href="https://www.elastic.co/products/logstash">Logstash</a>) to add structure to your log data. To do this, open the <code class="highlighter-rouge">logsIngestion.yaml</code> file (which may be empty) you specified in the Proxy configuration file, and write this example config which specifies basic instructions for parsing log data:</p>

<div class="language-yaml highlighter-rouge"><pre class="highlight"><code><span class="s">aggregationIntervalSeconds</span><span class="pi">:</span> <span class="s">5 </span> <span class="c1"># Metrics are aggregated and sent at this interval</span>
<span class="s">counters</span><span class="pi">:</span>
<span class="s">  - pattern</span><span class="pi">:</span> <span class="s1">'</span><span class="s">%{COMBINEDAPACHELOG}'</span>
<span class="s">    metricName</span><span class="pi">:</span> <span class="s1">'</span><span class="s">combined_apache_log_lines' </span> <span class="c1"># +1 for every log line matching this pattern</span>
<span class="s">gauges</span><span class="pi">:</span>
<span class="s">  - pattern</span><span class="pi">:</span> <span class="s1">'</span><span class="s">%{COMBINEDAPACHELOG}'</span>
<span class="s">    metricName</span><span class="pi">:</span> <span class="s1">'</span><span class="s">apacheStatus'</span>
<span class="s">    valueLabel</span><span class="pi">:</span> <span class="s1">'</span><span class="s">response' </span> <span class="c1"># Which value should be pulled from the COMBINEDAPACHELOG grok? Instantaneous value of most recently parsed HTTP return response code.</span>
<span class="s">histograms</span><span class="pi">:</span>
<span class="s">  - pattern</span><span class="pi">:</span> <span class="s1">'</span><span class="s">%{COMBINEDAPACHELOG}'</span>
<span class="s">    metricName</span><span class="pi">:</span> <span class="s1">'</span><span class="s">responseBytes'</span>
<span class="s">    valueLabel</span><span class="pi">:</span> <span class="s1">'</span><span class="s">bytes'</span>
<span class="s"> </span> <span class="c1"># A helpful example below, this one won't parse any nginx logs.</span>
<span class="s">  - pattern</span><span class="pi">:</span> <span class="s1">'</span><span class="s">My</span><span class="nv"> </span><span class="s">operation</span><span class="nv"> </span><span class="s">took</span><span class="nv"> </span><span class="s">%{NUMBER:duration}</span><span class="nv"> </span><span class="s">seconds'</span>
<span class="s">    metricName</span><span class="pi">:</span> <span class="s1">'</span><span class="s">myOperationDuration'</span>
<span class="s">    valueLabel</span><span class="pi">:</span> <span class="s1">'</span><span class="s">duration'</span>
</code></pre>
</div>

<p>This configuration file is parsed as a POJO; see the <a href="http://static.javadoc.io/com.wavefront/proxy/4.1/com/wavefront/agent/config/LogsIngestionConfig.html">javadoc</a> for more details on each field. Log lines are given structure with <a href="http://github.com/thekrakken/java-grok">java-grok</a>, which is the syntax for the Logstash grok plugin. Then, through <code class="highlighter-rouge">valueLabel</code>, you can specify which part of the log line contains the metrics to send to Wavefront. There are three supported modes of aggregation: counters, gauges, and histograms. See <a href="http://metrics.dropwizard.io/3.1.0/getting-started/">Dropwizard documentation</a> for more.</p>

<p>You can think of grok patterns as regexes with macros. Each macro can be made up of sub-macros, and each macro can bind a substring to a given label. For example:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>LOGLEVEL (INFO|WARNING|ERROR)
BASE_FORMAT %{LOGLEVEL:level} %{NUMBER:timestamp}
FULL_FORMAT %{BASE_FORMAT} my operation took %{NUMBER:value} seconds.*
</code></pre>
</div>

<p>FULL_FORMAT above would match a log line such as:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>INFO 1476925272 my operation took 42 seconds (and other info here)
</code></pre>
</div>

<p>In the above example, the log message has a timestamp. You can use this timestamp to match the message for ingestion, but Wavefront always ingests the resulting metric at the time the Wavefront proxy sees the log, <em>not</em> the time the message was logged in your system. Therefore, the resulting metric would be: <strong>myOperationDuration 42 &lt;proxy time&gt; source=&lt;host&gt;</strong></p>

<p>The Wavefront proxy includes these <a href="http://github.com/wavefrontHQ/java/blob/master/proxy/src/main/resources/patterns/patterns">patterns</a> and you can always add more.</p>

<h4 id="notes-on-specifying-grok-patterns">Notes on Specifying Grok Patterns</h4>

<ul>
  <li>Bugs in grok patterns can be frustrating to debug. Try your grok pattern with a sample log line in one of the grok parsing debugger tools (e.g. <a href="http://grokdebug.herokuapp.com/">grok debugger</a>).</li>
  <li>As in the examples above, use single quotes unless you need double quotes. YAML parsers escape sequences inside double quotes, which is usually not what you want (e.g. “\n” will be the newline character).</li>
  <li>Remember grok patterns expand to regex patterns. This means if you wanted to capture a number inside brackets, you would need ‘\[NUMBER:myNum\]’ or “\\[NUMBER:myNum\\]” (for point 2 above). A <a href="http://regex101.com/">regex debugger</a> may be helpful.</li>
  <li>The Wavefront proxy <a href="http://static.javadoc.io/com.wavefront/proxy/4.1/com/wavefront/agent/config/LogsIngestionConfig.html">javadoc</a> contains advanced grok examples.</li>
</ul>

<h4 id="testing-grok-patterns-in-interactive-mode">Testing Grok Patterns in Interactive Mode</h4>

<p>To test grok patterns before sending data to Wavefront, you can run the proxy in a mode where it reads lines from stdin and prints the generated metric when there is a match with a pattern in logsIngestionConfig.yaml.  To run the proxy in test mode:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code>java -jar /opt/wavefront/wavefront-proxy/bin/wavefront-push-agent.jar -f /etc/wavefront/wavefront-proxy/wavefront.conf --testLogs &lt; foo.txt
</code></pre>
</div>

<p>where <code class="highlighter-rouge">foo.txt</code> has, e.g.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>counter foo 42
...
</code></pre>
</div>

<p>You can also omit ``&lt; foo.txt` to use interactive terminal mode.</p>

<h4 id="updating-log-ingestion-configuration">Updating Log Ingestion Configuration</h4>

<p>You can update the log ingestion configuration and the Wavefront proxy 4.4 will hot load the log ingestion configuration file while running:</p>

<ol>
  <li>Edit the log ingestion configuration file and save.</li>
  <li>
    <p>To verify that the updated file loaded successfully, open the Wavefront proxy log file and look for a log message like:</p>

    <div class="highlighter-rouge"><pre class="highlight"><code> INFO: Loaded new config: &lt;config_json&gt;
</code></pre>
    </div>

    <p>If there is a problem with the updated configuration, you’ll see a log line like this:</p>

    <div class="highlighter-rouge"><pre class="highlight"><code> WARNING: Could not load a new logs ingestion config file, check above for a stack trace.
</code></pre>
    </div>
  </li>
</ol>

<h2 id="sending-log-data-to-a-wavefront-proxy-with-filebeat">Sending Log Data to a Wavefront Proxy With Filebeat</h2>

<p>This section describes how to send log data to a Wavefront proxy using Filebeat.</p>

<p>The Wavefront proxy automatically assigns metrics a <strong>source</strong> according to the machine that sent corresponding log data. This is done with Filebeat host metadata – so each host should be able to resolve its own hostname; otherwise the IP address is used.</p>

<h3 id="direct-log-ingestion-architecture-filebeat">Direct Log Ingestion Architecture (Filebeat)</h3>

<p><img src="images/log_data_filebeat.png" alt="Filebeat Log Harvesting Architecture" /></p>

<h3 id="instructions">Instructions</h3>

<ol>
  <li>Install <a href="http://www.elastic.co/guide/en/beats/filebeat/current/filebeat-installation.html">Filebeat</a> on any production node that has log data to send to Wavefront:
    <ul>
      <li>
        <p>For Ubuntu:</p>

        <div class="highlighter-rouge"><pre class="highlight"><code>curl -L -O https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-5.0.1-amd64.deb
sudo dpkg -i filebeat-5.0.1-amd64.deb
</code></pre>
        </div>
      </li>
      <li>
        <p>For Redhat:</p>

        <div class="highlighter-rouge"><pre class="highlight"><code>curl -L -O https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-5.0.1-x86_64.rpm
sudo rpm -vi filebeat-5.0.1-x86_64.rpm
</code></pre>
        </div>
      </li>
    </ul>

    <p>The default config file is very well commented and is in <code class="highlighter-rouge">/etc/filebeat/filebeat.yml</code>. This deployment sends NGINX logs to a Logstash worker.</p>
  </li>
</ol>

<div class="language-yaml highlighter-rouge"><pre class="highlight"><code><span class="c1"># Exhaustive example: https://raw.githubusercontent.com/elastic/filebeat/master/etc/filebeat.yml</span>
<span class="c1"># Docs: https://www.elastic.co/guide/en/beats/filebeat/current/configuration-filebeat-options.html</span>

<span class="s">filebeat</span><span class="pi">:</span>
<span class="s">prospectors</span><span class="pi">:</span>
<span class="c1"># Each - is a prospector. Below are the prospector specific configurations</span>
<span class="pi">-</span>
<span class="s">paths</span><span class="pi">:</span>
<span class="s">  - /var/log/nginx/*.log</span>
<span class="s">input_type</span><span class="pi">:</span> <span class="s">log</span>
<span class="c1"># You usually want tail_files: true. Wavefront shows the ingestion timestamp to be when a log line</span>
<span class="c1"># was received, not when it was written to your logfile. For this reason, ingesting back-in-time</span>
<span class="c1"># data will surprise you unless you are expecting that.</span>
<span class="s">tail_files</span><span class="pi">:</span> <span class="s">true</span>
<span class="c1"># This is important if you have some kind of log rotator. Filebeat won't let go of an open FD</span>
<span class="c1"># of a rotated file without this option.</span>
<span class="s">close_inactive</span><span class="pi">:</span> <span class="s">5m</span>
<span class="s">registry_file</span><span class="pi">:</span> <span class="s">/var/lib/filebeat/registry</span>
<span class="s">output</span><span class="pi">:</span>
<span class="s">  logstash: </span> <span class="c1"># Even though we're sending directly to the Wavefront proxy, we use this. The protocol (Lumberjack) is the same.</span>
<span class="s">    hosts</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">wavefront-proxy.mycompany.com:5044"</span><span class="pi">]</span><span class="s"> </span> <span class="c1"># Replace this with the host:port of your Wavefront proxy</span>
<span class="s">logging</span><span class="pi">:</span>
<span class="s">  to_syslog</span><span class="pi">:</span> <span class="s">false</span>
<span class="s">  to_files</span><span class="pi">:</span> <span class="s">true</span>
<span class="s">  files</span><span class="pi">:</span>
    <span class="s">path</span><span class="pi">:</span> <span class="s">/var/log/filebeat</span>
    <span class="s">name</span><span class="pi">:</span> <span class="s">filebeat.log</span>
    <span class="s">rotateeverybytes</span><span class="pi">:</span> <span class="s">10485760</span> <span class="c1"># = 10MB</span>
    <span class="s">keepfiles</span><span class="pi">:</span> <span class="s">7</span>
<span class="c1"># Available log levels are: critical, error, warning, info, debug</span>
<span class="s">level</span><span class="pi">:</span> <span class="s">info</span>
</code></pre>
</div>

<ol>
  <li>
    <p>Start Filebeat:</p>

    <div class="highlighter-rouge"><pre class="highlight"><code>sudo service filebeat restart
</code></pre>
    </div>

    <p>To confirm that Filebeat is sending log data, run</p>

    <div class="highlighter-rouge"><pre class="highlight"><code>tail -100 /var/log/filebeat/filebeat.log
</code></pre>
    </div>

    <p>You should see lines like this:</p>

    <div class="highlighter-rouge"><pre class="highlight"><code>2016-10-19T22:27:32Z INFO Harvester started for file: /home/ubuntu/foo.log
2016-10-19T22:27:37Z INFO Events sent: 20048
2016-10-19T22:27:37Z INFO Registry file updated. 1 states written.
2016-10-19T22:27:40Z INFO Events sent: 20048
2016-10-19T22:27:40Z INFO Registry file updated. 1 states written.
2016-10-19T22:27:42Z INFO Events sent: 11647
</code></pre>
    </div>

    <p>In the Wavefront proxy log, there will be log entries indicating it is connected to Filebeat:</p>

    <div class="highlighter-rouge"><pre class="highlight"><code>Nov 21, 2016 11:19:17 AM New filebeat connection
</code></pre>
    </div>
  </li>
</ol>

<p>Filebeat keeps a registry file (in the above config, at <code class="highlighter-rouge">/var/lib/filebeat/registry</code>) that tells Filebeat where it left off in the event of a shutdown. To start from a clean state, stop Filebeat, clear this file, and start Filebeat.</p>

<h2 id="sending-log-data-to-a-wavefront-proxy-with-tcp">Sending Log Data to a Wavefront Proxy With TCP</h2>

<p>This section describes how to send log data to a Wavefront proxy over a TCP socket. A typical use case would be to send Splunk data.</p>

<p>The Wavefront proxy automatically assigns metrics a <strong>source</strong> according to the machine that sent the log data. The Proxy first tries a reverse DNS lookup; if that fails, the IP address is used.</p>

<h3 id="direct-log-ingestion-architecture-raw-tcp--splunk">Direct Log Ingestion Architecture (Raw TCP / Splunk)</h3>

<p><img src="images/log_data_tcp.png" alt="TCP Log Harvesting Architecture" /></p>

<h3 id="instructions-1">Instructions</h3>

<p>These instructions are tailored for Splunk integration, but you can send any newline-separated payload to the Wavefront proxy.</p>

<p><a href="http://docs.splunk.com/Documentation/Splunk/6.5.0/Forwarding/Forwarddatatothird-partysystemsd">Forward data to third-party systems</a> shows how you can fork your log data from Splunk to a third-party system. Add the following to your <code class="highlighter-rouge">outputs.conf</code> file:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>[tcpout]

[tcpout:fastlane]
server = &lt;my_wavefront_proxy_ip&gt;:5055
sendCookedData = false
</code></pre>
</div>

<h2 id="querying-log-data">Querying Log Data</h2>

<p>After configuring the Wavefront proxy to send log data, you could issue a queries such as:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>rate(ts(combined_apache_log_lines))
ts(responseBytes.p99)
</code></pre>
</div>



    <div class="tags">
        
        <b>Labels: </b>
        
        
        
        <a href="label_integrations.html" class="btn btn-default navbar-btn cursorNorm label-btn" role="button">integrations</a>
        
        
        
    </div>

    

</div>

<hr class="shaded"/>

<footer>
            <div class="row">
                <div class="col-lg-12 footer">
               &copy;2017 Wavefront. All rights reserved. <br />
 Site last generated: 2017-04-03 18:42:41 -0700 <br />
<p></p>
<p><img src="images/wavefront_logo.png" alt="Wavefront logo"/></p>
                </div>
            </div>
</footer>


    </div>
    <!-- /.row -->
</div>
<!-- /.container -->
    </div>

</body>

<!-- the google_analytics_id gets auto inserted from the config file -->



<script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-91867056-1','auto');ga('require','displayfeatures');ga('send','pageview');</script>



</html>